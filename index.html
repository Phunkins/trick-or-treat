<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trick or Treat</title>
    <style>
        body, html {
            height: 100%;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #000;
            color: #fff;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }
        #container {
            position: relative;
            width: 100%;
            height: 100%;
            max-width: 1000px;
            max-height: 600px;
        }
        #door, #silhouette, #candy, #bag {
            position: absolute;
            width: 100%;
            height: auto;
            max-height: 100%;
            transition: opacity 0.5s;
        }
        #door.open {
            opacity: 0;
        }
        #silhouette, #candy, #bag {
            opacity: 0;
        }
        #text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3em;
            opacity: 0;
            transition: opacity 0.5s;
        }
        #popup {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #fff;
            color: #000;
            padding: 20px;
            border-radius: 10px;
            display: none;
            flex-direction: column;
            align-items: center;
            box-shadow: 0px 0px 10px 0px rgba(0, 0, 0, 0.75);
        }
        #thankYouMessage {
            display: none;
            font-size: 1.2em;
            color: green;
        }
    </style>
</head>
<body>
    <div id="container">
        <img id="door" src="door.jpg" alt="Closed Door">
        <img id="silhouette" src="silhouette.png" alt="Silhouette">
        <img id="candy" src="candy.png" alt="Candy">
        <img id="bag" src="bag.png" alt="Bag">
        <div id="text">Trick or Treat!</div>
        <div id="popup">
            <p>Enter Your Eth Address (0x...):</p>
            <input type="text" id="ethAddress">
            <p>Twitter Handle:</p>
            <input type="text" id="twitterHandle">
            <button id="submit">Submit</button>
            <p id="thankYouMessage">Thank you for entering your address, it has been recorded for WL on the Phunkins mint!</p>
        </div>
    </div>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-analytics.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCywrM-SW-JloFcfduOsy3M2MzeSYiO91A",
            authDomain: "phunkins-d01ed.firebaseapp.com",
            projectId: "phunkins-d01ed",
            storageBucket: "phunkins-d01ed.appspot.com",
            messagingSenderId: "936260550028",
            appId: "1:936260550028:web:86c4ecc7faada642fe2aa9",
            measurementId: "G-53NDCXVDHW"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const db = getFirestore(app);

        // Elements
        const door = document.getElementById('door');
        const silhouette = document.getElementById('silhouette');
        const candy = document.getElementById('candy');
        const bag = document.getElementById('bag');
        const text = document.getElementById('text');
        const popup = document.getElementById('popup');
        const submitButton = document.getElementById('submit');
        const thankYouMessage = document.getElementById('thankYouMessage');

        door.addEventListener('click', () => {
            door.classList.add('open');
            setTimeout(() => {
                text.style.opacity = 1;
                silhouette.style.opacity = 1;
            }, 1000);
            setTimeout(() => {
                candy.style.opacity = 1;
                bag.style.opacity = 1;
            }, 2000);
            setTimeout(() => {
                document.body.style.backgroundColor = '#000';
                popup.style.display = 'flex';
            }, 3000);
        });

        submitButton.addEventListener('click', async () => {
            const ethAddress = document.getElementById('ethAddress').value;
            const twitterHandle = document.getElementById('twitterHandle').value;

            try {
                await addDoc(collection(db, "submissions"), {
                    ethAddress: ethAddress,
                    twitterHandle: twitterHandle,
                    timestamp: new Date()
                });

                thankYouMessage.style.display = 'block';
                document.getElementById('ethAddress').style.display = 'none';
                document.getElementById('twitterHandle').style.display = 'none';
                submitButton.style.display = 'none';
            } catch (error) {
                console.error('Error writing document: ', error);
                alert('There was an issue submitting your information. Please try again.');
            }
        });
    </script>
</body>
</html>
