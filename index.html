<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Mouse & Touch Reactive Lines with Sliders</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body {
            margin: 0;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            height: 100vh;
            background-color: black;
            overflow: hidden;
            color: white; /* Set default text color to white */
        }

        #svgContainer {
            width: 100%;
            height: 100%;
            background-color: black; /* Initially black */
        }

        svg {
            display: block;
            width: 100%;
            height: 100%;
        }

        path {
            fill: none;
            stroke-width: 2;
        }

        .controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 10px;
            z-index: 10;
        }

        .color-picker {
            margin: 0 10px; /* Add margin to color pickers */
            border: none;
            outline: none;
            background: transparent;
            color: white;
            font-size: 16px;
        }

        .slider {
            margin: 10px 10px; /* Add margin to sliders */
        }

        .button-container {
            display: flex;
            align-items: center;
        }

        .clear-button, .save-button, .toggle-button {
            margin-left: 10px;
            padding: 10px 20px;
            background-color: #555; /* Default background color */
            color: white; /* Default text color */
            border: 2px solid white; /* Default border color */
            cursor: pointer;
        }

        .clear-button:hover, .save-button:hover, .toggle-button:hover {
            background-color: #c3ff00; /* Hover effect */
        }

        .toggle-button.active {
            background-color: #c3ff00; /* Change color when active */
        }
    </style>
</head>
<body>

<div class="controls">
    <div>
        <label for="colorPicker">Line Color</label>
        <input type="color" id="colorPicker" class="color-picker" value="#c3ff00">
        
        <label for="bgColorPicker">Background Color</label>
        <input type="color" id="bgColorPicker" class="color-picker" value="#000000">
    </div>

    <div>
        <label for="peakSlider">Peak Intensity</label>
        <input id="peakSlider" class="slider" type="range" min="0" max="100" value="50">

        <label for="radiusSlider">Radius</label>
        <input id="radiusSlider" class="slider" type="range" min="50" max="300" value="150">
    </div>

    <div class="button-container">
        <button id="toggleButton" class="toggle-button">Increase Elevation</button>
        <button id="clearButton" class="clear-button">Clear</button>
        <button id="saveButton" class="save-button">Save as PNG</button>
    </div>
</div>

<!-- Wrap the SVG in a container -->
<div id="svgContainer">
    <svg id="interactiveSvg" xmlns="http://www.w3.org/2000/svg">
        <!-- Curved lines will be generated -->
    </svg>
</div>

<script>
    const svg = document.getElementById('interactiveSvg');
    const colorPicker = document.getElementById('colorPicker');
    const bgColorPicker = document.getElementById('bgColorPicker');
    const clearButton = document.getElementById('clearButton');
    const saveButton = document.getElementById('saveButton');
    const peakSlider = document.getElementById('peakSlider');
    const radiusSlider = document.getElementById('radiusSlider');
    const toggleButton = document.getElementById('toggleButton');
    const totalLines = 75;
    const svgWidth = svg.clientWidth;
    const svgHeight = svg.clientHeight;
    const lineGap = svgHeight / totalLines;
    const paths = [];
    const baseLineStates = [];
    const currentLineStates = [];
    let proximityRadius = 150;
    let peakIntensity = 0.5;
    const maxPeakHeight = 200;

    let isInteracting = false; // Track interaction state (mouse or touch)
    let increaseMode = true; // Track the toggle button state

    // Generate horizontal lines
    function createLine(yPosition) {
        const path = document.createElementNS("http://www.w3.org/2000/svg", 'path');
        let d = `M 0 ${yPosition}`;

        const baseLine = [];
        const currentLine = [];

        for (let x = 0; x <= svgWidth; x += 50) {
            d += ` L ${x} ${yPosition}`;
            baseLine.push(yPosition);
            currentLine.push(yPosition);
        }

        path.setAttribute('d', d);
        path.setAttribute('stroke', colorPicker.value);
        svg.appendChild(path);
        paths.push(path);
        baseLineStates.push(baseLine);
        currentLineStates.push(currentLine);
    }

    // Create initial static lines
    for (let i = 0; i < totalLines; i++) {
        const yPos = i * lineGap;
        createLine(yPos);
    }

    function handleInteractionStart(event) {
        isInteracting = true;
        if (event.type === 'touchstart') {
            event = event.touches[0]; // Normalize touch event
        }
        if (event.button === 2) {
            event.preventDefault(); // Prevent right-click menu
        }
    }

    function handleInteractionEnd() {
        isInteracting = false;
    }

    function handleInteractionMove(event) {
        if (!isInteracting) return;

        if (event.type === 'touchmove') {
            event = event.touches[0]; // Normalize touch event
        }

        const svgRect = svg.getBoundingClientRect();
        const mouseX = event.clientX - svgRect.left;
        const mouseY = event.clientY - svgRect.top;

        paths.forEach((path, index) => {
            const baseY = index * lineGap;
            let d = `M 0 ${baseY}`;

            for (let x = 0; x <= svgWidth; x += 50) {
                const pointIndex = x / 50;
                const baseYPosition = baseLineStates[index][pointIndex];
                const currentY = currentLineStates[index][pointIndex];
                const distance = Math.hypot(mouseX - x, mouseY - currentY);
                const heightEffect = Math.max(0, proximityRadius - distance);
                const normalizedEffect = heightEffect / proximityRadius;

                let yOffset;

                if (increaseMode) {
                    const quickIncrease = Math.pow(normalizedEffect, 3) * 200 * peakIntensity;
                    yOffset = currentY - quickIncrease;
                    yOffset = Math.max(baseYPosition - maxPeakHeight, yOffset);
                } else {
                    const quickDecrease = Math.pow(normalizedEffect, 3) * 200 * peakIntensity;
                    yOffset = currentY + quickDecrease;
                    yOffset = Math.min(baseYPosition, yOffset);
                }

                currentLineStates[index][pointIndex] = yOffset;
                d += ` L ${x} ${currentLineStates[index][pointIndex]}`;
            }

            path.setAttribute('d', d);
        });
    }

    // Mouse and touch event listeners
    svg.addEventListener('mousedown', handleInteractionStart);
    svg.addEventListener('touchstart', handleInteractionStart);

    svg.addEventListener('mouseup', handleInteractionEnd);
    svg.addEventListener('touchend', handleInteractionEnd);

    svg.addEventListener('mousemove', handleInteractionMove);
    svg.addEventListener('touchmove', handleInteractionMove);

    // Clear button event to reset lines to flat
    clearButton.addEventListener('click', () => {
        paths.forEach((path, index) => {
            const yPos = index * lineGap;
            let d = `M 0 ${yPos}`;
            for (let x = 0; x <= svgWidth; x += 50) {
                d += ` L ${x} ${yPos}`;
            }
            path.setAttribute('d', d);
            currentLineStates[index] = [...baseLineStates[index]]; // Reset current line state
        });
    });

    // Save button event to save as PNG
    saveButton.addEventListener('click', () => {
        const svgContainer = document.getElementById('svgContainer');
        html2canvas(svgContainer, { backgroundColor: null }).then(canvas => {
            const link = document.createElement('a');
            link.href = canvas.toDataURL();
            link.download = 'lines_image.png';
            link.click();
        });
    });

    // Toggle button event to switch between increase and decrease modes
    toggleButton.addEventListener('click', () => {
        increaseMode = !increaseMode;
        toggleButton.classList.toggle('active');
        toggleButton.textContent = increaseMode ? 'Increase Elevation' : 'Decrease Elevation';
    });

    // Update line color dynamically
    colorPicker.addEventListener('input', () => {
        paths.forEach(path => {
            path.setAttribute('stroke', colorPicker.value);
        });

        // Update button and text colors
        document.querySelectorAll('button, label').forEach(el => {
            el.style.color = colorPicker.value;
        });
    });

    // Update background color dynamically
    bgColorPicker.addEventListener('input', () => {
        document.getElementById('svgContainer').style.backgroundColor = bgColorPicker.value;
    });

    // Update peak intensity from the slider
    peakSlider.addEventListener('input', () => {
        peakIntensity = peakSlider.value / 100;
    });

    // Update proximity radius from the slider
    radiusSlider.addEventListener('input', () => {
        proximityRadius = radiusSlider.value;
    });

    // Disable context menu on right-click
    window.addEventListener('contextmenu', (e) => e.preventDefault());
</script>
</body>
</html>
